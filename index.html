<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Screen AI Helper</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #0f0f0f;
        color: #ffffff;
        padding: 20px;
    }

    h2 {
        text-align: center;
        margin-bottom: 10px;
    }

    textarea {
        width: 100%;
        height: 120px;
        background: #1e1e1e;
        color: #ffffff;
        border: 1px solid #444;
        border-radius: 6px;
        padding: 10px;
        margin-bottom: 10px;
        resize: vertical;
    }

    .buttons {
        text-align: center;
        margin-bottom: 15px;
    }

    button {
        padding: 8px 16px;
        margin: 5px;
        background: #333;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    button:hover {
        background: #555;
    }

    .section-title {
        margin-top: 15px;
        font-size: 14px;
        opacity: 0.8;
    }
</style>
</head>

<body>

<h2>Screen AI Helper</h2>

<div class="section-title">OCR TEXT</div>
<textarea id="ocrText" placeholder="OCR text will appear here..."></textarea>

<div class="buttons">
    <button onclick="addText()">ADD</button>
    <button onclick="askAI()">GO</button>
    <button onclick="clearAll()">CLEAR</button>
</div>

<div class="section-title">SELECTED TEXT</div>
<textarea id="selectedText" readonly></textarea>

<div class="section-title">AI ANSWER</div>
<textarea id="answerBox" readonly></textarea>

<script>
    let collectedText = "";

    async function fetchOCR() {
        try {
            const res = await fetch("http://127.0.0.1:5000/get-ocr");
            const data = await res.json();
            document.getElementById("ocrText").value = data.ocr_text || "";
        } catch (e) {
            console.log("Backend not reachable");
        }
    }

    function addText() {
        const box = document.getElementById("ocrText");
        const selected = box.value.substring(
            box.selectionStart,
            box.selectionEnd
        );

        if (selected.trim()) {
            collectedText += selected + "\n\n";
            document.getElementById("selectedText").value = collectedText;
        }
    }

    async function askAI() {
        if (!collectedText.trim()) {
            alert("No text selected");
            return;
        }

        document.getElementById("answerBox").value = "‚è≥ Asking AI...";

        await fetch("http://127.0.0.1:5000/select", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ text: collectedText })
        });

        const res = await fetch("http://127.0.0.1:5000/ask-ai", {
            method: "POST"
        });

        const data = await res.json();
        document.getElementById("answerBox").value = data.answer || "No answer";
    }

    function clearAll() {
        collectedText = "";
        document.getElementById("ocrText").value = "";
        document.getElementById("selectedText").value = "";
        document.getElementById("answerBox").value = "";
    }

    // Auto-refresh OCR every 2 seconds
    setInterval(fetchOCR, 2000);
</script>

</body>
</html>
